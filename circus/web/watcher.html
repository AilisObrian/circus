<%inherit file="base.html"/>

<%block name="title">
%if client:
Connected to ${client.endpoint}
%else:
Disconnected
%endif
</%block>


<script type="text/javascript" src="/media/jquery.min.js"></script>
<script type="text/javascript" src="/media/jquery.sparkline.min.js"></script>
<script type="text/javascript" src="/media/jquery-ui.min.js"></script>


% if not client:
Not connected. Go <a href="/">back</a> to connect.
% endif

% if client:

<div id="tabs">
 <div>
 <ul class="ui-tabs-nav">
   <li class="ui-tabs-selected"><a href="#tabs-1">Stats</a></li>
   <li><a href="#tabs-2">Options</a></li>
 </ul>
 </div>
 <div style="clear: both"></div> 
 <div id="tabs-1" class="ui-tabs-panel">
   <div class="panel">
    <p>Watcher <strong>${name}</strong> runs <strong>${client.get_option(name, 'numprocesses')}</strong> processes.</p>
    %for pid in client.get_pids(name):
    <div class="stat" id="pid_${pid}">
     Process #${pid}
     <div>CPU : <span id="${pid}_cpu" class="sparklines"></span></div>
     <div>Mem : <span id="${pid}_mem" class="sparklines"></span></div>
    </div>
    %endfor
    <div style="clear: both"></div>
  <a class="action" href="/watchers/${name}/process/incr">Add a process</a>
  <a class="action" href="/watchers/${name}/process/decr">Remove a process</a>
  <div style="clear: both"></div>
  </div>
 </div> 
 <div id="tabs-2" class="ui-tabs-panel">
     <p>Current Options :</p>
  <ul>
   %for name_, value in client.get_options(name):
   <li>${name_}: ${value}</li>
   %endfor
  </ul>
 </div>

 </div>

<script type="text/javascript">
$(function() {
    $("#tabs").tabs();
                });

function updateGraphs() {

    $.getJSON('/watchers/${name}/stats/cpu', function(data) {
            $.each(data, function(key, val) {
                var id = '#' + key + '_cpu';
                $(id).sparkline(val, {width: '75%'});
                });
            });
    $.getJSON('/watchers/${name}/stats/mem', function(data) {
            $.each(data, function(key, val) {
                var id = '#' + key + '_mem';
                $(id).sparkline(val, {width: '75%'});
                });
            });

}

// see if we want to provide this as a glider
setInterval("updateGraphs()", 2000);

</script>

% endif
