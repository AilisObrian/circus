<%inherit file="base.html"/>
 <%block name="title">
%if client:
Connected to ${client.endpoint}
%else:
Disconnected
%endif
</%block>


% if not client:
  <legend>Connect to a Circus system</legend>
  <form action="/connect" method="POST">
    <input type="text" name="endpoint" value="tcp://127.0.0.1:5555"/>
    <input type="submit"/>
</form>
% endif

% if client:


<div id="tabs">
 <div>
 <ul class="ui-tabs-nav">
   <li class="ui-tabs-selected"><a href="#tabs-1">Overview</a></li>
   <li><a href="#tabs-2">Options</a></li>
   <li><a href="#tabs-3">Add Watcher</a></li>
 </ul>
 </div>
 <div style="clear: both"></div>
 <div id="tabs-1" class="ui-tabs-panel">
     <%
       goptions = dict(client.get_global_options())
     %>
     <div>
     
    <table class="watchers">
        <tr>
            <th>Name</th>
            <th>Processes</th>
            <th>Command</th>
            <th>Shell</th>
            <th>uid</th>
            <th>gid</th>
            <th>Status</th>
        </tr>
        <tr>
            % for watcher, options in client.watchers:
        <tr>
            <td>
                <a href="/watchers/${watcher}">${watcher}</a>
            </td>
            <td style="text-align: center">

                <span class="label">${options['numprocesses']}</span>
                <a href="/watchers/${watcher}/process/incr?redirect=/#tabs-1"><span class="orangelabel">+</span></a>
          <a href="/watchers/${watcher}/process/decr?redirect=/#tabs-1"><span class="orangelabel">-</span></a>

      </td>
      <td>
          ${options['cmd']} ${options['args']}
      </td>
      <td>
          ${options['shell']}
      </td>
      <td>
          ${options['uid']}
      </td>
      <td>
          ${options['uid']}
      </td>
            <td>
         <a href="/watchers/${watcher}/switch_status">
                         <img title="${client.get_status(watcher)}" class="status"
                         src="/media/${client.get_status(watcher)}.png" width="20" height="20"/>
            ${client.get_status(watcher)}

         </a>
           </td>
        </tr>

        %endfor
    </table>
    <div class="stat" style="float:none; margin-top: 2em; margin-left: -.5em">
     <div style="margin-bottom: 10px">
         <span class="orangelabel">circusd</span>
     </div>
     <div style="margin-bottom: 4px">
         <span class="label">CPU</span>
         <span id="circusd_cpu" class="sparklines"></span>
         <span class="label" id="circusd_last_cpu" style="margin-left: 4px;
             float: right">0.0 %</span>
     </div>
     <div>
         <span class="label">Mem</span>
         <span id="circusd_mem" class="sparklines"></span>
         <span class="label" style="margin-left: 4px; float: right" id="circusd_last_mem">0.0 %</span>
     </div>
    </div>


    </div>
</div>
 <div id="tabs-2" class="ui-tabs-panel">
         <table class="options" style="margin-top: 10px">
    <tr>
        <td>
            ZeroMQ endpoint used to connect clients like <i>circusctl</i> or 
            <i>circushttpd</i>
        </td>
        <td>
            <span class="label">${goptions['endpoint']}</span>
        </td>
    </tr>
    <tr>
        <td>
            ZeroMQ endpoint used for pub/sub
        </td>
        <td>
            <span class="label">${goptions['pubsub_endpoint']}</span>
        </td>
    </tr>
    <tr>
        <td>
            If True, Circus detects flapping processes.
        </td>
        <td>
            <span class="label">${goptions['check_flapping']}</span>
        </td>
    </tr>
    <tr>
        <td>
            Delay in seconds for the ZMQ polling.
        </td>
        <td>
            <span class="label">${goptions['check_delay']}</span>
        </td>
    </tr>



    </table>

 </div>
 <div id="tabs-3" class="ui-tabs-panel">
  <form action="add_watcher" method="POST" width="100%">

      <p>
          <label for="name">Name</label>
          <input type="text" name="name"></input>
      </p>
      <p>
          <label for="cmd">Command</label>
          <input type="text" name="cmd"></input>
      </p>
      <p>
          <label for="working_dir">Working directory</label>
          <input type="text" name="working_dir"></input>
      </p>
      <p>
          <label for="numprocesses">Number of processes</label>
          <input type="text" name="numprocesses"></input>
      </p>
      <p>
          <label for="shell">Run in Shell ?</label>
          <input type="checkbox" name="shell"></input>
      </p>

      <p>
          <input type="submit"></input>
    </p>
  </form>
  </div>
  
  <script type="text/javascript">
  $(function() {
      $("#tabs").tabs();
      initializeCircusdGraph();
      });
  setInterval("refreshCircusdGraph()", 1000);

 </script>

% endif

